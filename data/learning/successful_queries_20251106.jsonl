{"timestamp": "2025-11-06T21:01:36.446522", "query": "gere gráfico de evolução do produto 592294 na une 2365", "code": "import pandas as pd\nimport plotly.express as px\n\ndef analyze_data(df: pd.DataFrame):\n    \"\"\"\n    Gera um gráfico de evolução de vendas para um produto específico em uma UNE específica.\n\n    Args:\n        df (pd.DataFrame): DataFrame contendo os dados de vendas e estoque.\n\n    Returns:\n        plotly.graph_objects.Figure: Gráfico de linha da evolução de vendas.\n        dict: Mensagem de erro se o produto/UNE não for encontrado.\n    \"\"\"\n    # Parâmetros da query\n    produto_codigo = 592294\n    une_id = 2365\n\n    # 1. Validação de colunas essenciais\n    required_cols = ['codigo', 'une', 'une_nome'] + [f'mes_{i:02d}' for i in range(1, 13)]\n    for col in required_cols:\n        if col not in df.columns:\n            return {\"error\": f\"Coluna '{col}' não encontrada no DataFrame. Verifique o dataset.\"}\n\n    # 2. Filtrar o DataFrame para o produto e UNE específicos\n    # Usamos 'une' para o ID numérico e 'une_nome' para exibição\n    df_filtered = df[(df['codigo'] == produto_codigo) & (df['une'] == une_id)]\n\n    if df_filtered.empty:\n        return {\"error\": f\"Produto com código {produto_codigo} não encontrado na UNE {une_id}.\"}\n\n    # Pegar a primeira (e única) linha do produto/UNE filtrado\n    # .iloc[0] retorna uma Series, o que é crucial para o tratamento correto\n    produto_data = df_filtered.iloc[0]\n\n    # 3. Preparar os dados para o gráfico de evolução temporal\n    # mes_01 é o MAIS RECENTE, então precisamos inverter a ordem para um gráfico temporal\n    # que vai do mais antigo para o mais recente.\n    # Criamos uma lista de colunas de meses e extraímos os valores.\n    cols_meses = [f'mes_{i:02d}' for i in range(1, 13)]\n    vendas_mensais = produto_data[cols_meses].values.tolist()\n\n    # Os meses devem ser rotulados do mais antigo para o mais recente para o gráfico\n    # Se mes_01 é o mais recente, então mes_12 é o mais antigo.\n    # Para exibir corretamente, vamos criar rótulos que representem a ordem cronológica.\n    # Ex: Mês -11 (mais antigo), Mês -10, ..., Mês 0 (mais recente)\n    # Ou simplesmente Mês 1 (mais antigo) a Mês 12 (mais recente)\n    # Vamos usar Mês 1 (mais antigo) a Mês 12 (mais recente) e inverter os dados.\n    \n    # Inverter a lista de vendas para que mes_12 (mais antigo) venha primeiro e mes_01 (mais recente) por último\n    vendas_mensais_ordenadas = vendas_mensais[::-1]\n    \n    # Criar rótulos de meses em ordem cronológica\n    meses_labels = [f'Mês {i+1}' for i in range(12)] # Mês 1 (mais antigo) ... Mês 12 (mais recente)\n\n    # Criar um DataFrame temporal para o Plotly\n    df_temporal = pd.DataFrame({\n        'periodo': meses_labels,\n        'vendas': vendas_mensais_ordenadas\n    })\n\n    # 4. Criar o gráfico de linha usando Plotly Express\n    une_nome_display = produto_data['une_nome']\n    product_name_display = produto_data['nome_produto']\n\n    fig = px.line(\n        df_temporal,\n        x='periodo',\n        y='vendas',\n        title=f'Evolução de Vendas do Produto \"{product_name_display}\" (Cód: {produto_codigo}) na UNE \"{une_nome_display}\" (ID: {une_id})',\n        labels={'periodo': 'Período (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)', 'vendas': 'Vendas'},\n        markers=True,\n        template='plotly_white',\n        color_discrete_sequence=px.colors.qualitative.Plotly # Sequência de cores padrão do Plotly\n    )\n\n    # Adicionar anotações para o mês mais recente e mais antigo\n    fig.add_annotation(\n        x=df_temporal['periodo'].iloc[0],\n        y=df_temporal['vendas'].iloc[0],\n        text=\"Mês Mais Antigo\",\n        showarrow=True,\n        arrowhead=1,\n        ax=0,\n        ay=-40\n    )\n    fig.add_annotation(\n        x=df_temporal['periodo'].iloc[-1],\n        y=df_temporal['vendas'].iloc[-1],\n        text=\"Mês Mais Recente\",\n        showarrow=True,\n        arrowhead=1,\n        ax=0,\n        ay=-40\n    )\n\n    return fig\n\n# Exemplo de uso (simulando load_data)\n# Para testar, você precisaria de um DataFrame 'df' com as colunas especificadas.\n# df = load_data() # Descomente esta linha em um ambiente real\n\n# Simulação de dados para teste\ndata = {\n    'codigo': [592294, 592294, 12345],\n    'nome_produto': ['CANETA AZUL', 'CANETA AZUL', 'LAPIS PRETO'],\n    'ean': ['7891234567890', '7891234567890', '7890987654321'],\n    'nomesegmento': ['PAPELARIA', 'PAPELARIA', 'PAPELARIA'],\n    'NOMECATEGORIA': ['CANETAS', 'CANETAS', 'LAPIS'],\n    'nomegrupo': ['ESCRITA', 'ESCRITA', 'ESCRITA'],\n    'NOMESUBGRUPO': ['ESFEROGRAFICAS', 'ESFEROGRAFICAS', 'GRAFITE'],\n    'NOMEFABRICANTE': ['BIC', 'BIC', 'FABER-CASTELL'],\n    'venda_30_d': [150, 120, 80],\n    'une': [2365, 2366, 2365],\n    'une_nome': ['ALC', 'NIL', 'ALC'],\n    'estoque_atual': [500, 400, 300],\n    'estoque_lv': [200, 150, 100],\n    'estoque_cd': [300, 250, 200],\n    'preco_38_percent': [2.50, 2.50, 1.80]\n}\n# Adicionar dados de vendas mensais (mes_01 a mes_12)\nfor i in range(1, 13):\n    data[f'mes_{i:02d}'] = [100 + i*5, 80 + i*3, 50 + i*2] # Exemplo de dados de vendas\n    if i == 1: # mes_01 (mais recente)\n        data[f'mes_{i:02d}'][0] = 180 # Venda mais recente para o produto 592294 na UNE 2365\n    elif i == 12: # mes_12 (mais antigo)\n        data[f'mes_{i:02d}'][0] = 120 # Venda mais antiga para o produto 592294 na UNE 2365\n\ndf = pd.DataFrame(data)\n\n# Chamar a função de análise\nresult = analyze_data(df)\n\n# O resultado será um objeto Figure do Plotly ou um dicionário de erro\n# Para exibir o gráfico em um ambiente como Jupyter Notebook ou Streamlit:\n# if isinstance(result, dict) and \"error\" in result:\n#     print(result[\"error\"])\n# else:\n#     result.show() # Isso abrirá o gráfico em seu navegador padrão", "rows": 1, "success": true}
{"timestamp": "2025-11-06T21:04:53.278581", "query": "gere gráfico de evolução do produto 592294 na une 2365", "code": "import pandas as pd\nimport plotly.express as px\n\ndef analyze_data(df: pd.DataFrame):\n    \"\"\"\n    Gera um gráfico de evolução de vendas para um produto específico em uma UNE específica\n    ao longo dos últimos 12 meses.\n\n    Args:\n        df (pd.DataFrame): DataFrame contendo os dados de vendas e estoque.\n\n    Returns:\n        plotly.graph_objects.Figure: Gráfico de linha da evolução de vendas.\n        dict: Mensagem de erro se o produto/UNE não for encontrado ou colunas estiverem faltando.\n    \"\"\"\n    # Parâmetros da query\n    produto_codigo = 592294\n    une_id = 2365\n\n    # 1. Validação de colunas essenciais\n    # mes_01 é o mais recente, mes_12 é o mais antigo\n    cols_meses = [f'mes_{i:02d}' for i in range(1, 13)]\n    required_cols = ['codigo', 'une', 'une_nome', 'nome_produto'] + cols_meses\n\n    for col in required_cols:\n        if col not in df.columns:\n            return {\"error\": f\"Coluna '{col}' não encontrada no DataFrame. Verifique o dataset.\"}\n\n    # 2. Filtrar o DataFrame para o produto e UNE específicos\n    df_filtered = df[(df['codigo'] == produto_codigo) & (df['une'] == une_id)]\n\n    if df_filtered.empty:\n        return {\"error\": f\"Produto com código {produto_codigo} não encontrado na UNE {une_id}.\"}\n\n    # Pegar a primeira (e única) linha do produto/UNE filtrado\n    # .iloc[0] retorna uma Series, o que é crucial para o tratamento correto dos valores mes_XX\n    produto_data = df_filtered.iloc[0]\n\n    # 3. Preparar os dados para o gráfico de evolução temporal\n    # mes_01 é o MAIS RECENTE, mes_12 é o MAIS ANTIGO.\n    # Para um gráfico de evolução cronológica, precisamos ordenar do mais antigo para o mais recente.\n    # Extraímos os valores e invertemos a lista.\n    vendas_mensais_raw = [produto_data[col] for col in cols_meses]\n    \n    # Inverter a lista para que mes_12 (mais antigo) venha primeiro e mes_01 (mais recente) por último\n    vendas_mensais_ordenadas = vendas_mensais_raw[::-1]\n    \n    # Criar rótulos de meses em ordem cronológica (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)\n    meses_labels = [f'Mês {i+1}' for i in range(12)]\n\n    # Criar um DataFrame temporal para o Plotly\n    df_temporal = pd.DataFrame({\n        'periodo': meses_labels,\n        'vendas': vendas_mensais_ordenadas\n    })\n\n    # 4. Criar o gráfico de linha usando Plotly Express\n    une_nome_display = produto_data['une_nome']\n    product_name_display = produto_data['nome_produto']\n\n    fig = px.line(\n        df_temporal,\n        x='periodo',\n        y='vendas',\n        title=f'Evolução de Vendas do Produto \"{product_name_display}\" (Cód: {produto_codigo}) na UNE \"{une_nome_display}\" (ID: {une_id})',\n        labels={'periodo': 'Período (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)', 'vendas': 'Vendas'},\n        markers=True,\n        template='plotly_white',\n        color_discrete_sequence=px.colors.qualitative.Plotly # Sequência de cores padrão do Plotly\n    )\n\n    # Adicionar anotações para o mês mais recente e mais antigo para maior clareza\n    if not df_temporal.empty:\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[0],\n            y=df_temporal['vendas'].iloc[0],\n            text=f\"Mês Mais Antigo: {df_temporal['vendas'].iloc[0]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"blue\")\n        )\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[-1],\n            y=df_temporal['vendas'].iloc[-1],\n            text=f\"Mês Mais Recente: {df_temporal['vendas'].iloc[-1]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"green\")\n        )\n\n    return fig\n\n# Para simular o ambiente e testar a função:\n# df = load_data() # Em um ambiente real, esta função carregaria seu DataFrame.\n\n# Simulação de dados para teste\ndata = {\n    'codigo': [592294, 592294, 12345],\n    'nome_produto': ['CANETA AZUL', 'CANETA AZUL', 'LAPIS PRETO'],\n    'ean': ['7891234567890', '7891234567890', '7890987654321'],\n    'nomesegmento': ['PAPELARIA', 'PAPELARIA', 'PAPELARIA'],\n    'NOMECATEGORIA': ['CANETAS', 'CANETAS', 'LAPIS'],\n    'nomegrupo': ['ESCRITA', 'ESCRITA', 'ESCRITA'],\n    'NOMESUBGRUPO': ['ESFEROGRAFICAS', 'ESFEROGRAFICAS', 'GRAFITE'],\n    'NOMEFABRICANTE': ['BIC', 'BIC', 'FABER-CASTELL'],\n    'venda_30_d': [150, 120, 80],\n    'une': [2365, 2366, 2365],\n    'une_nome': ['ALC', 'NIL', 'ALC'],\n    'estoque_atual': [500, 400, 300],\n    'estoque_lv': [200, 150, 100],\n    'estoque_cd': [300, 250, 200],\n    'preco_38_percent': [2.50, 2.50, 1.80]\n}\n# Adicionar dados de vendas mensais (mes_01 = mais recente, mes_12 = mais antigo)\n# Vamos criar uma tendência de aumento para o produto 592294 na UNE 2365\nfor i in range(1, 13):\n    # Para o produto 592294 na UNE 2365, vendas crescem do mes_12 para o mes_01\n    # mes_12 (mais antigo) = 100, mes_01 (mais recente) = 210\n    data[f'mes_{i:02d}'] = [100 + (12 - i) * 10, 80 + i*3, 50 + i*2] # Exemplo de dados de vendas\n\ndf = pd.DataFrame(data)\n\n# Chamar a função de análise\nresult = analyze_data(df)\n\n# O resultado será um objeto Figure do Plotly ou um dicionário de erro\n# Para exibir o gráfico em um ambiente como Jupyter Notebook ou Streamlit:\n# if isinstance(result, dict) and \"error\" in result:\n#     print(result[\"error\"])\n# else:\n#     result.show() # Isso abrirá o gráfico em seu navegador padrão", "rows": 1, "success": true}
{"timestamp": "2025-11-06T21:13:56.920301", "query": "gere gráfico de evolução do produto 592294 na une 2365", "code": "import pandas as pd\nimport plotly.express as px\n\ndef analyze_data(df: pd.DataFrame):\n    \"\"\"\n    Gera um gráfico de evolução de vendas para um produto específico em uma UNE específica\n    ao longo dos últimos 12 meses.\n\n    Args:\n        df (pd.DataFrame): DataFrame contendo os dados de vendas e estoque.\n\n    Returns:\n        plotly.graph_objects.Figure: Gráfico de linha da evolução de vendas.\n        dict: Mensagem de erro se o produto/UNE não for encontrado ou colunas estiverem faltando.\n    \"\"\"\n    # Parâmetros da query\n    produto_codigo = 592294\n    une_id = 2365\n\n    # 1. Validação de colunas essenciais\n    # mes_01 é o mais recente, mes_12 é o mais antigo\n    cols_meses = [f'mes_{i:02d}' for i in range(1, 13)]\n    required_cols = ['codigo', 'une', 'une_nome', 'nome_produto'] + cols_meses\n\n    for col in required_cols:\n        if col not in df.columns:\n            return {\"error\": f\"Coluna '{col}' não encontrada no DataFrame. Verifique o dataset.\"}\n\n    # 2. Filtrar o DataFrame para o produto e UNE específicos\n    df_filtered = df[(df['codigo'] == produto_codigo) & (df['une'] == une_id)]\n\n    if df_filtered.empty:\n        return {\"error\": f\"Produto com código {produto_codigo} não encontrado na UNE {une_id}.\"}\n\n    # Pegar a primeira (e única) linha do produto/UNE filtrado\n    # .iloc[0] retorna uma Series, o que é crucial para o tratamento correto dos valores mes_XX\n    produto_data = df_filtered.iloc[0]\n\n    # 3. Preparar os dados para o gráfico de evolução temporal\n    # mes_01 é o MAIS RECENTE, mes_12 é o MAIS ANTIGO.\n    # Para um gráfico de evolução cronológica, precisamos ordenar do mais antigo para o mais recente.\n    # Extraímos os valores na ordem mes_01 a mes_12.\n    vendas_mensais_raw = [produto_data[col] for col in cols_meses]\n    \n    # Inverter a lista para que mes_12 (mais antigo) venha primeiro e mes_01 (mais recente) por último\n    vendas_mensais_ordenadas = vendas_mensais_raw[::-1]\n    \n    # Criar rótulos de meses em ordem cronológica (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)\n    meses_labels = [f'Mês {i+1}' for i in range(12)]\n\n    # Criar um DataFrame temporal para o Plotly\n    df_temporal = pd.DataFrame({\n        'periodo': meses_labels,\n        'vendas': vendas_mensais_ordenadas\n    })\n\n    # 4. Criar o gráfico de linha usando Plotly Express\n    une_nome_display = produto_data['une_nome']\n    product_name_display = produto_data['nome_produto']\n\n    fig = px.line(\n        df_temporal,\n        x='periodo',\n        y='vendas',\n        title=f'Evolução de Vendas do Produto \"{product_name_display}\" (Cód: {produto_codigo}) na UNE \"{une_nome_display}\" (ID: {une_id})',\n        labels={'periodo': 'Período (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)', 'vendas': 'Vendas'},\n        markers=True,\n        template='plotly_white',\n        color_discrete_sequence=px.colors.qualitative.Plotly # Sequência de cores padrão do Plotly\n    )\n\n    # Adicionar anotações para o mês mais recente e mais antigo para maior clareza\n    if not df_temporal.empty:\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[0],\n            y=df_temporal['vendas'].iloc[0],\n            text=f\"Mês Mais Antigo: {df_temporal['vendas'].iloc[0]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"blue\")\n        )\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[-1],\n            y=df_temporal['vendas'].iloc[-1],\n            text=f\"Mês Mais Recente: {df_temporal['vendas'].iloc[-1]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"green\")\n        )\n\n    return fig\n\n# O resultado será um objeto Figure do Plotly ou um dicionário de erro\n# Para exibir o gráfico em um ambiente como Jupyter Notebook ou Streamlit:\n# if isinstance(result, dict) and \"error\" in result:\n#     print(result[\"error\"])\n# else:\n#     result.show() # Isso abrirá o gráfico em seu navegador padrão\n\n# Exemplo de uso (simulando load_data)\n# df = load_data() # Descomente esta linha em um ambiente real\n\n# Simulação de dados para teste\ndata = {\n    'codigo': [592294, 592294, 12345],\n    'nome_produto': ['CANETA AZUL', 'CANETA AZUL', 'LAPIS PRETO'],\n    'ean': ['7891234567890', '7891234567890', '7890987654321'],\n    'nomesegmento': ['PAPELARIA', 'PAPELARIA', 'PAPELARIA'],\n    'NOMECATEGORIA': ['CANETAS', 'CANETAS', 'LAPIS'],\n    'nomegrupo': ['ESCRITA', 'ESCRITA', 'ESCRITA'],\n    'NOMESUBGRUPO': ['ESFEROGRAFICAS', 'ESFEROGRAFICAS', 'GRAFITE'],\n    'NOMEFABRICANTE': ['BIC', 'BIC', 'FABER-CASTELL'],\n    'venda_30_d': [150, 120, 80],\n    'une': [2365, 2366, 2365],\n    'une_nome': ['ALC', 'NIL', 'ALC'],\n    'estoque_atual': [500, 400, 300],\n    'estoque_lv': [200, 150, 100],\n    'estoque_cd': [300, 250, 200],\n    'preco_38_percent': [2.50, 2.50, 1.80]\n}\n# Adicionar dados de vendas mensais (mes_01 = mais recente, mes_12 = mais antigo)\n# Vamos criar uma tendência de aumento para o produto 592294 na UNE 2365\nfor i in range(1, 13):\n    # Para o produto 592294 na UNE 2365, vendas crescem do mes_12 para o mes_01\n    # mes_12 (mais antigo) = 100, mes_01 (mais recente) = 210\n    data[f'mes_{i:02d}'] = [100 + (12 - i) * 10, 80 + i*3, 50 + i*2] # Exemplo de dados de vendas\n\ndf = pd.DataFrame(data)\n\n# Chamar a função de análise\nresult = analyze_data(df)", "rows": 1, "success": true}
{"timestamp": "2025-11-06T21:28:44.150888", "query": "gere gráfico de evolução do produto 592294 na une 2365", "code": "import pandas as pd\nimport plotly.express as px\n\ndef analyze_data(df: pd.DataFrame):\n    \"\"\"\n    Gera um gráfico de evolução de vendas para um produto específico em uma UNE específica\n    ao longo dos últimos 12 meses.\n\n    Args:\n        df (pd.DataFrame): DataFrame contendo os dados de vendas e estoque.\n\n    Returns:\n        plotly.graph_objects.Figure: Gráfico de linha da evolução de vendas.\n        dict: Mensagem de erro se o produto/UNE não for encontrado ou colunas estiverem faltando.\n    \"\"\"\n    # Parâmetros da query\n    produto_codigo = 592294\n    une_id = 2365\n\n    # 1. Validação de colunas essenciais\n    # mes_01 é o mais recente, mes_12 é o mais antigo\n    cols_meses = [f'mes_{i:02d}' for i in range(1, 13)]\n    required_cols = ['codigo', 'une', 'une_nome', 'nome_produto'] + cols_meses\n\n    for col in required_cols:\n        if col not in df.columns:\n            return {\"error\": f\"Coluna '{col}' não encontrada no DataFrame. Verifique o dataset.\"}\n\n    # 2. Filtrar o DataFrame para o produto e UNE específicos\n    df_filtered = df[(df['codigo'] == produto_codigo) & (df['une'] == une_id)]\n\n    if df_filtered.empty:\n        return {\"error\": f\"Produto com código {produto_codigo} não encontrado na UNE {une_id}.\"}\n\n    # Pegar a primeira (e única) linha do produto/UNE filtrado\n    # .iloc[0] retorna uma Series, o que é crucial para o tratamento correto dos valores mes_XX\n    produto_data = df_filtered.iloc[0]\n\n    # 3. Preparar os dados para o gráfico de evolução temporal\n    # mes_01 é o MAIS RECENTE, mes_12 é o MAIS ANTIGO.\n    # Para um gráfico de evolução cronológica, precisamos ordenar do mais antigo para o mais recente.\n    # Extraímos os valores na ordem mes_01 a mes_12.\n    vendas_mensais_raw = [produto_data[col] for col in cols_meses]\n    \n    # Inverter a lista para que mes_12 (mais antigo) venha primeiro e mes_01 (mais recente) por último\n    vendas_mensais_ordenadas = vendas_mensais_raw[::-1]\n    \n    # Criar rótulos de meses em ordem cronológica (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)\n    meses_labels = [f'Mês {i+1}' for i in range(12)]\n\n    # Criar um DataFrame temporal para o Plotly\n    df_temporal = pd.DataFrame({\n        'periodo': meses_labels,\n        'vendas': vendas_mensais_ordenadas\n    })\n\n    # 4. Criar o gráfico de linha usando Plotly Express\n    une_nome_display = produto_data['une_nome']\n    product_name_display = produto_data['nome_produto']\n\n    fig = px.line(\n        df_temporal,\n        x='periodo',\n        y='vendas',\n        title=f'Evolução de Vendas do Produto \"{product_name_display}\" (Cód: {produto_codigo}) na UNE \"{une_nome_display}\" (ID: {une_id})',\n        labels={'periodo': 'Período (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)', 'vendas': 'Vendas'},\n        markers=True,\n        template='plotly_white',\n        color_discrete_sequence=px.colors.qualitative.Plotly # Sequência de cores padrão do Plotly\n    )\n\n    # Adicionar anotações para o mês mais recente e mais antigo para maior clareza\n    if not df_temporal.empty:\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[0],\n            y=df_temporal['vendas'].iloc[0],\n            text=f\"Mês Mais Antigo: {df_temporal['vendas'].iloc[0]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"blue\")\n        )\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[-1],\n            y=df_temporal['vendas'].iloc[-1],\n            text=f\"Mês Mais Recente: {df_temporal['vendas'].iloc[-1]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"green\")\n        )\n\n    return fig\n\n# O resultado será um objeto Figure do Plotly ou um dicionário de erro\n# Para exibir o gráfico em um ambiente como Jupyter Notebook ou Streamlit:\n# if isinstance(result, dict) and \"error\" in result:\n#     print(result[\"error\"])\n# else:\n#     result.show() # Isso abrirá o gráfico em seu navegador padrão\n\n# Exemplo de uso (simulando load_data)\n# df = load_data() # Descomente esta linha em um ambiente real\n\n# Simulação de dados para teste\ndata = {\n    'codigo': [592294, 592294, 12345],\n    'nome_produto': ['CANETA AZUL', 'CANETA AZUL', 'LAPIS PRETO'],\n    'ean': ['7891234567890', '7891234567890', '7890987654321'],\n    'nomesegmento': ['PAPELARIA', 'PAPELARIA', 'PAPELARIA'],\n    'NOMECATEGORIA': ['CANETAS', 'CANETAS', 'LAPIS'],\n    'nomegrupo': ['ESCRITA', 'ESCRITA', 'ESCRITA'],\n    'NOMESUBGRUPO': ['ESFEROGRAFICAS', 'ESFEROGRAFICAS', 'GRAFITE'],\n    'NOMEFABRICANTE': ['BIC', 'BIC', 'FABER-CASTELL'],\n    'venda_30_d': [150, 120, 80],\n    'une': [2365, 2366, 2365],\n    'une_nome': ['ALC', 'NIL', 'ALC'],\n    'estoque_atual': [500, 400, 300],\n    'estoque_lv': [200, 150, 100],\n    'estoque_cd': [300, 250, 200],\n    'preco_38_percent': [2.50, 2.50, 1.80]\n}\n# Adicionar dados de vendas mensais (mes_01 = mais recente, mes_12 = mais antigo)\n# Vamos criar uma tendência de aumento para o produto 592294 na UNE 2365\nfor i in range(1, 13):\n    # Para o produto 592294 na UNE 2365, vendas crescem do mes_12 para o mes_01\n    # mes_12 (mais antigo) = 100, mes_01 (mais recente) = 210\n    data[f'mes_{i:02d}'] = [100 + (12 - i) * 10, 80 + i*3, 50 + i*2] # Exemplo de dados de vendas\n\ndf = pd.DataFrame(data)\n\n# Chamar a função de análise\nresult = analyze_data(df)", "rows": 1, "success": true}
{"timestamp": "2025-11-06T21:31:36.246805", "query": "gere gráfico de evolução do produto 592294 na une 2365", "code": "import pandas as pd\nimport plotly.express as px\n\ndef analyze_data(df: pd.DataFrame):\n    \"\"\"\n    Gera um gráfico de evolução de vendas para um produto específico em uma UNE específica\n    ao longo dos últimos 12 meses.\n\n    Args:\n        df (pd.DataFrame): DataFrame contendo os dados de vendas e estoque.\n\n    Returns:\n        plotly.graph_objects.Figure: Gráfico de linha da evolução de vendas.\n        dict: Mensagem de erro se o produto/UNE não for encontrado ou colunas estiverem faltando.\n    \"\"\"\n    # Parâmetros da query\n    produto_codigo = 592294\n    une_id = 2365\n\n    # 1. Validação de colunas essenciais\n    # mes_01 é o mais recente, mes_12 é o mais antigo\n    cols_meses = [f'mes_{i:02d}' for i in range(1, 13)]\n    required_cols = ['codigo', 'une', 'une_nome', 'nome_produto'] + cols_meses\n\n    for col in required_cols:\n        if col not in df.columns:\n            return {\"error\": f\"Coluna '{col}' não encontrada no DataFrame. Verifique o dataset.\"}\n\n    # 2. Filtrar o DataFrame para o produto e UNE específicos\n    df_filtered = df[(df['codigo'] == produto_codigo) & (df['une'] == une_id)]\n\n    if df_filtered.empty:\n        return {\"error\": f\"Produto com código {produto_codigo} não encontrado na UNE {une_id}.\"}\n\n    # Pegar a primeira (e única) linha do produto/UNE filtrado\n    # .iloc[0] retorna uma Series, o que é crucial para o tratamento correto dos valores mes_XX\n    produto_data = df_filtered.iloc[0]\n\n    # 3. Preparar os dados para o gráfico de evolução temporal\n    # mes_01 é o MAIS RECENTE, mes_12 é o MAIS ANTIGO.\n    # Para um gráfico de evolução cronológica, precisamos ordenar do mais antigo para o mais recente.\n    # Extraímos os valores na ordem mes_01 a mes_12.\n    vendas_mensais_raw = [produto_data[col] for col in cols_meses]\n    \n    # Inverter a lista para que mes_12 (mais antigo) venha primeiro e mes_01 (mais recente) por último\n    vendas_mensais_ordenadas = vendas_mensais_raw[::-1]\n    \n    # Criar rótulos de meses em ordem cronológica (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)\n    meses_labels = [f'Mês {i+1}' for i in range(12)]\n\n    # Criar um DataFrame temporal para o Plotly\n    df_temporal = pd.DataFrame({\n        'periodo': meses_labels,\n        'vendas': vendas_mensais_ordenadas\n    })\n\n    # 4. Criar o gráfico de linha usando Plotly Express\n    une_nome_display = produto_data['une_nome']\n    product_name_display = produto_data['nome_produto']\n\n    fig = px.line(\n        df_temporal,\n        x='periodo',\n        y='vendas',\n        title=f'Evolução de Vendas do Produto \"{product_name_display}\" (Cód: {produto_codigo}) na UNE \"{une_nome_display}\" (ID: {une_id})',\n        labels={'periodo': 'Período (Mês 1 = Mais Antigo, Mês 12 = Mais Recente)', 'vendas': 'Vendas'},\n        markers=True,\n        template='plotly_white',\n        color_discrete_sequence=px.colors.qualitative.Plotly # Sequência de cores padrão do Plotly\n    )\n\n    # Adicionar anotações para o mês mais recente e mais antigo para maior clareza\n    if not df_temporal.empty:\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[0],\n            y=df_temporal['vendas'].iloc[0],\n            text=f\"Mês Mais Antigo: {df_temporal['vendas'].iloc[0]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"blue\")\n        )\n        fig.add_annotation(\n            x=df_temporal['periodo'].iloc[-1],\n            y=df_temporal['vendas'].iloc[-1],\n            text=f\"Mês Mais Recente: {df_temporal['vendas'].iloc[-1]:.2f}\",\n            showarrow=True,\n            arrowhead=1,\n            ax=0,\n            ay=-40,\n            font=dict(size=10, color=\"green\")\n        )\n\n    return fig\n\n# O resultado será um objeto Figure do Plotly ou um dicionário de erro\n# Para exibir o gráfico em um ambiente como Jupyter Notebook ou Streamlit:\n# if isinstance(result, dict) and \"error\" in result:\n#     print(result[\"error\"])\n# else:\n#     result.show() # Isso abrirá o gráfico em seu navegador padrão\n\n# Exemplo de uso (simulando load_data)\n# df = load_data() # Descomente esta linha em um ambiente real\n\n# Simulação de dados para teste\ndata = {\n    'codigo': [592294, 592294, 12345],\n    'nome_produto': ['CANETA AZUL', 'CANETA AZUL', 'LAPIS PRETO'],\n    'ean': ['7891234567890', '7891234567890', '7890987654321'],\n    'nomesegmento': ['PAPELARIA', 'PAPELARIA', 'PAPELARIA'],\n    'NOMECATEGORIA': ['CANETAS', 'CANETAS', 'LAPIS'],\n    'nomegrupo': ['ESCRITA', 'ESCRITA', 'ESCRITA'],\n    'NOMESUBGRUPO': ['ESFEROGRAFICAS', 'ESFEROGRAFICAS', 'GRAFITE'],\n    'NOMEFABRICANTE': ['BIC', 'BIC', 'FABER-CASTELL'],\n    'venda_30_d': [150, 120, 80],\n    'une': [2365, 2366, 2365],\n    'une_nome': ['ALC', 'NIL', 'ALC'],\n    'estoque_atual': [500, 400, 300],\n    'estoque_lv': [200, 150, 100],\n    'estoque_cd': [300, 250, 200],\n    'preco_38_percent': [2.50, 2.50, 1.80]\n}\n# Adicionar dados de vendas mensais (mes_01 = mais recente, mes_12 = mais antigo)\n# Vamos criar uma tendência de aumento para o produto 592294 na UNE 2365\nfor i in range(1, 13):\n    # Para o produto 592294 na UNE 2365, vendas crescem do mes_12 para o mes_01\n    # mes_12 (mais antigo) = 100, mes_01 (mais recente) = 210\n    data[f'mes_{i:02d}'] = [100 + (12 - i) * 10, 80 + i*3, 50 + i*2] # Exemplo de dados de vendas\n\ndf = pd.DataFrame(data)\n\n# Chamar a função de análise\nresult = analyze_data(df)", "rows": 1, "success": true}
